<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Understanding iptalbes · BIS</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="This article will give you a brief introduction to iptbles, its tables and the order of execution."><meta name=author content="BIS"><meta name=generator content="Hugo 0.101.0"><link rel=stylesheet href=/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=/plugins/slick/slick.css><link rel=stylesheet href=/plugins/animate/animate.css><link rel=stylesheet href=/plugins/venobox/venobox.css><link rel=stylesheet href=/plugins/themify-icons/themify-icons.css><link rel=stylesheet href=/plugins/hightlight/syntax.css><link rel=stylesheet href=/plugins/fontawesome/font-awesome.min.css><link rel=stylesheet href=/plugins/tocbot/tocbot.css><link rel=stylesheet href=/plugins/bigger-picture/bigger-picture.css><link rel=stylesheet href=/scss/style.css media=screen><link rel=icon href=/favicon.png type=image/png><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=apple-touch-icon sizes=57x57 href=images/favicon-57.png><link rel=apple-touch-icon sizes=72x72 href=images/favicon-72.png><link rel=apple-touch-icon sizes=114x114 href=images/favicon-114.png><link rel=apple-touch-icon sizes=144x144 href=images/favicon-144.png><link href=/opensearchdescription.xml rel=search title='Content search' type=application/opensearchdescription+xml><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="jimmysong.io"><meta name=twitter:creator content="@jimmysongio"><meta property="og:url" content="https://sdmx.io/blog/understanding-iptables/"><meta property="og:title" content="Understanding iptalbes"><meta property="twitter:title" content="Understanding iptalbes"><meta property="og:description" content="This article will give you a brief introduction to iptbles, its tables and the order of execution."><meta property="twitter:description" content="This article will give you a brief introduction to iptbles, its tables and the order of execution."><meta property="og:image" content="https://sdmx.io/images/banner/iptables.jpg"><meta property="twitter:image" content="https://sdmx.io/images/banner/iptables.jpg"></head><body><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa fa-arrow-circle-up" aria-hidden=true></i></button><header class="fixed-top header"><div class="navigation w-100"><div class=container><nav class="navbar navbar-expand-lg navbar-light p-0"><a class=navbar-brand href=/><img class=img-fluid width=200px src=/images/logo.png alt="Open source software for official statistics"></a>
<button class="navbar-toggler rounded-0" type=button data-toggle=collapse data-target=#navigation aria-controls=navigation aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>About</a><div class=dropdown-menu><a class=dropdown-item href=/about>ABOUT SDMX.IO</a>
<a class=dropdown-item href=/members>SDMX.IO MEMBERS</a></div></li><li class=nav-item><a class=nav-link href=/blog>Blog</a></li><li class=nav-item><a class=nav-link href=https://lib.jimmysong.io target=_blank rel=noopener>Book</a></li><li class=nav-item><a class=nav-link href=https://lib.jimmysong.io/event/ target=_blank rel=noopener>Event</a></li><li class=nav-item><a class=nav-link href=/notice>Notice</a></li><li class=nav-item><a class=nav-link href=/tags>Tags</a></li><li class=nav-item><a class=nav-link href=/contact>Contact</a></li></ul></div></nav></div></div></header><section class="bg-cover page-title-section overlay" style=background-image:url(/images/backgrounds/page-title.webp),url(/images/backgrounds/page-title.webp)><div class=container><div class=row><div class=col-md-8><ul class="list-inline custom-breadcrumb"><li class="list-inline-item h2"><a class="text-white font-secondary" href=/blog>Blogs</a></li><li class=list-inline-item><i class="ti-angle-right text-white"></i></li><li class="list-inline-item text-white h3 font-secondary">Understanding Iptalbes</li></ul><p class=text-white>This article will give you a brief introduction to iptbles, its tables and the order of execution.</p></div></div></div></section><section class=section-sm><div class="container blog"><div class=row><div class="col-lg-8 article-content"><div class=row><div class=col-12><ul class=list-inline><li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">Date
:</span>May 12, 2022</li><li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">Category
:</span><a href=/categories/istio>
Istio</a></li><li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">Word Count
:</span>678 words</li><li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">Reading Time
:</span>3 Minute</li></ul></div><div class="col-12 my-4"><div class=border-bottom></div></div><div class="col-12 content"><p>iptables is an important feature in the Linux kernel and has a wide range of applications. iptables is used by default in Istio for transparent traffic hijacking. Understanding iptables is very important for us to understand how Istio works. This article will give you a brief introduction to iptbles.</p><h2 id=iptables-introduction>iptables introduction</h2><p>iptables is a management tool for netfilter, the firewall software in the Linux kernel. netfilter is located in the user space and is part of netfilter. netfilter is located in the kernel space and has not only network address conversion, but also packet content modification and packet filtering firewall functions.</p><p>Before learning about iptables for Init container initialization, let&rsquo;s go over iptables and rule configuration.</p><p>The following figure shows the iptables call chain.</p><p><figure class="mx-auto text-center"><img src=/blog/understanding-iptables/iptables.jpg data-img=/blog/understanding-iptables/iptables.jpg data-width=726 data-height=1443 alt=iptables.jpg data-caption="iptables 调用链"><figcaption>iptables 调用链</figcaption></figure></p><h3 id=iptables>iptables</h3><p>The iptables version used in the Init container is v1.6.0 and contains 5 tables.</p><ol><li>RAW is used to configure packets. Packets in RAW are not tracked by the system.</li><li>The filter is the default table used to house all firewall-related operations.</li><li>NAT is used for network address translation (e.g., port forwarding).</li><li>Mangle is used for modifications to specific packets (refer to corrupted packets).</li><li>Security is used to force access to control network rules.</li></ol><p>Note: In this example, only the NAT table is used.</p><p>The chain types in the different tables are as follows.</p><table><thead><tr><th>Rule name</th><th>raw</th><th>filter</th><th>nat</th><th>mangle</th><th>security</th></tr></thead><tbody><tr><td>PREROUTING</td><td>✓</td><td></td><td>✓</td><td>✓</td><td></td></tr><tr><td>INPUT</td><td></td><td>✓</td><td></td><td>✓</td><td>✓</td></tr><tr><td>OUTPUT</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr><tr><td>POSTROUTING</td><td></td><td></td><td>✓</td><td>✓</td><td></td></tr><tr><td>FORWARD</td><td></td><td>✓</td><td></td><td>✓</td><td>✓</td></tr></tbody></table><h3 id=understand-iptables-rules>Understand iptables rules</h3><p>View the default iptables rules in the <code>istio-proxy</code> container, the default view is the rules in the filter table.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ iptables -L -v
</span></span><span class=line><span class=cl>Chain INPUT <span class=o>(</span>policy ACCEPT 350K packets, 63M bytes<span class=o>)</span>
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     <span class=nb>source</span>               destination
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Chain FORWARD <span class=o>(</span>policy ACCEPT <span class=m>0</span> packets, <span class=m>0</span> bytes<span class=o>)</span>
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     <span class=nb>source</span>               destination
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Chain OUTPUT <span class=o>(</span>policy ACCEPT 18M packets, 1916M bytes<span class=o>)</span>
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     <span class=nb>source</span>               destination
</span></span></code></pre></div><p>We see three default chains, INPUT, FORWARD, and OUTPUT, with the first line of output in each chain indicating the chain name (INPUT/FORWARD/OUTPUT in this case), followed by the default policy (ACCEPT).</p><p>The following is a proposed structure diagram of iptables, where traffic passes through the INPUT chain and then enters the upper protocol stack, such as:</p><p><figure class="mx-auto text-center"><img src=/blog/understanding-iptables/iptables-chains.jpg data-img=/blog/understanding-iptables/iptables-chains.jpg data-width=1333 data-height=410 alt=iptables-chains.jpg data-caption="iptables chains"><figcaption>iptables chains</figcaption></figure></p><p>Multiple rules can be added to each chain and the rules are executed in order from front to back. Let&rsquo;s look at the table header definition of the rule.</p><ul><li><strong>PKTS</strong>: Number of matched messages processed</li><li><strong>bytes</strong>: cumulative packet size processed (bytes)</li><li><strong>Target</strong>: If the message matches the rule, the specified target is executed.</li><li><strong>PROT</strong>: Protocols such as TDP, UDP, ICMP, and ALL.</li><li><strong>opt</strong>: Rarely used, this column is used to display IP options.</li><li><strong>IN</strong>: Inbound network interface.</li><li><strong>OUT</strong>: Outbound network interface.</li><li><strong>source</strong>: the source IP address or subnet of the traffic, the latter being anywhere.</li><li><strong>destination</strong>: the destination IP address or subnet of the traffic, or anywhere.</li></ul><p>There is also a column without a header, shown at the end, which represents the options of the rule, and is used as an extended match condition for the rule to complement the configuration in the previous columns. prot, opt, in, out, source and destination and the column without a header shown after destination together form the match rule. TARGET is executed when traffic matches these rules.</p><p><strong>Types supported by TARGET</strong></p><p>Target types include ACCEPT, REJECT, DROP, LOG, SNAT, MASQUERADE, DNAT, REDIRECT, RETURN or jump to other rules, etc. You can determine where the telegram is going by executing only one rule in a chain that matches in order, except for the RETURN type, which is similar to the return statement in programming languages, which returns to its call point and continues to execute the next rule.</p><p>From the output, you can see that the Init container does not create any rules in the default link of iptables, but instead creates a new link.</p><h2 id=summary>Summary</h2><p>With the above brief introduction to iptables, you have understood how iptables works, the rule chain and its execution order.</p></div><div class="col-12 mb-4"><div class=border-bottom><p class=edit-page><a href=https://github.com/sdmxio/website/edit/master/content/en/blog/understanding-iptables/index.md><i class="fa fa-pencil-square-o" aria-hidden=true></i> Edit this page</a></p></div></div><div class=col-12><li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><a href=/tags/iptables class=badge>Iptables</a></li></div><div class=col-12><ul class="pager blog-pager"><li class=previous><a href=https://sdmx.io/blog/istio-components-and-ports/ data-toggle=tooltip data-placement=top title=" Istio component ports and functions in detail">&larr; Previous Post</a></li><li class=next><a href=https://sdmx.io/blog/istio-pod-process-lifecycle/ data-toggle=tooltip data-placement=top title="Istio data plane pod startup process explained">Next Post &rarr;</a></li></ul></div><div class=col-12></div></div></div><aside class="col-lg-4 sidebar"><div class="bg-white mb-4"><p class=sidebar-title>Categories</p><ul class=list-unstyled><li class=border-bottom><a href=/categories/cloud-native class="d-block pb-3 mt-3 text-capitalize">Cloud native</a></li><li class=border-bottom><a href=/categories/istio class="d-block pb-3 mt-3 text-capitalize">Istio</a></li><li class=border-bottom><a href=/categories/open-source class="d-block pb-3 mt-3 text-capitalize">Open source</a></li><li class=border-bottom><a href=/categories/private class="d-block pb-3 mt-3 text-capitalize">Private</a></li><li class=border-bottom><a href=/categories/service-mesh class="d-block pb-3 mt-3 text-capitalize">Service mesh</a></li></ul></div><div class="bg-white mb-4"><p class=sidebar-title>Tags</p><div id=tag-cloud><a href=/tags/abac style=font-size:.8rem>Abac</a>
<a href=/tags/aeraki style=font-size:.8rem>Aeraki</a>
<a href=/tags/api-gateway style=font-size:.8rem>API gateway</a>
<a href=/tags/cloud-native style=font-size:1.2330185680574361rem>Cloud native</a>
<a href=/tags/cncf style=font-size:.8rem>Cncf</a>
<a href=/tags/envoy style=font-size:1.0732042984363437rem>Envoy</a>
<a href=/tags/iptables style=font-size:1.2330185680574361rem>Iptables</a>
<a href=/tags/istio style=font-size:1.9807693330560248rem>Istio</a>
<a href=/tags/kuberentes style=font-size:1.0732042984363437rem>Kuberentes</a>
<a href=/tags/kubernetes style=font-size:1.346408596872687rem>Kubernetes</a>
<a href=/tags/multicluster style=font-size:.8rem>Multicluster</a>
<a href=/tags/ngac style=font-size:.8rem>Ngac</a>
<a href=/tags/nocalhost style=font-size:.8rem>Nocalhost</a>
<a href=/tags/rbac style=font-size:.8rem>Rbac</a>
<a href=/tags/service-mesh style=font-size:1.7451315883583074rem>Service mesh</a>
<a href=/tags/sidecar style=font-size:1.2330185680574361rem>Sidecar</a>
<a href=/tags/slime style=font-size:.8rem>Slime</a>
<a href=/tags/spiffe style=font-size:.8rem>Spiffe</a>
<a href=/tags/spire style=font-size:.8rem>Spire</a>
<a href=/tags/telepresence style=font-size:.8rem>Telepresence</a>
<a href=/tags/tsb style=font-size:.8rem>Tsb</a></div></div><div class="bg-white md-4"><p class=sidebar-title>Related article</p><div class="media border-bottom border-color pb-3 mb-3"><a href=/blog/istio-sidecar-traffic-types/><img class="mr-3 post-thumb-sm" src=/images/banner/mirror.jpg alt="blog banner"></a><div class=media-body><a href=/blog/istio-sidecar-traffic-types/><p class=mt-0>Traffic types and iptables rules in Istio sidecar explained</p></a>May 7, 2022</div></div></div><div class="bg-white py-4 box-shadow mb-4 sticky-top aside-toc d-none d-sm-block"><p class=sidebar-title>Table of content</p><nav id=TableOfContents><ul><li><a href=#iptables-introduction>iptables introduction</a><ul><li><a href=#iptables>iptables</a></li><li><a href=#understand-iptables-rules>Understand iptables rules</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></div></aside></div></div></section><footer><div class="footer bg-footer section-sm border-bottom"><div class=container><div class=row><div class="col-lg-4 col-sm-8 mb-5 mb-lg-0"><h4 class="text-white mb-5 text-uppercase">Follow Me</h4><ul class=list-unstyled><li class="mb-4 text-color">Twitter</li></div><div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-5 mb-md-0"><h4 class="text-white mb-5 text-uppercase">Blog</h4><ul class=list-unstyled><li class=mb-3><a class=text-color href=/blog/why-istio-need-spire/>Why would you need SPIRE for authentication with Istio?</a></li><li class=mb-3><a class=text-color href=/blog/istio-service-mesh-book/>In-Depth Understanding of Istio: Announcing the Publication of a New Istio Book</a></li><li class=mb-3><a class=text-color href=/blog/how-to-build-istio/>How to build Istio?</a></li></ul></div><div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-5 mb-md-0"><h4 class="text-white mb-5 text-uppercase">links</h4><ul class=list-unstyled><li class=mb-3><a class=text-color href=/awesome-cloud-native/ target=_blank rel=noopener>Awesome Cloud Native</a></li><li class=mb-3><a class=text-color href=https://cloudnative.to target=_blank rel=noopener>Cloud Native Community(China)</a></li><li class=mb-3><a class=text-color href=https://www.youtube.com/channel/UCwLGlxo3b492bzIgD8lnOKg/ target=_blank rel=noopener>Jimmy's YouTube Channel</a></li><li class=mb-3><a class=text-color href=https://tetrate.io/?jimmysong target=_blank rel=noopener>Tetrate - Service Mesh Company</a></li><li class=mb-3><a class=text-color href=https://istio.tetratelabs.io/ target=_blank rel=noopener>Tetrate Istio Distro</a></li></ul></div><div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-5 mb-md-0"><h4 class="text-white mb-5 text-uppercase">Books</h4><ul class=list-unstyled><li class=mb-3><a class=text-color href=https://lib.jimmysong.io/cloud-native/ target=_blank rel=noopener>Cloud Native Bible</a></li><li class=mb-3><a class=text-color href=https://lib.jimmysong.io/envoy-handbook/ target=_blank rel=noopener>Envoy Handbook</a></li><li class=mb-3><a class=text-color href=https://lib.jimmysong.io/istio-handbook/ target=_blank rel=noopener>Istio Handbook</a></li><li class=mb-3><a class=text-color href=https://lib.jimmysong.io/kubernetes-handbook/ target=_blank rel=noopener>Kubernetes Handbook</a></li></ul></div><div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-5 mb-md-0"><h4 class="text-white mb-5 text-uppercase">new notice</h4><ul class=list-unstyled><li class=mb-3><a class=text-color href=/notice/cloud-native-public-library/>Cloud Native library launch</a></li><li class=mb-3><a class=text-color href=/notice/tetrate-recruit/>The Enterprise Service Mesh company Tetrate is hiring</a></li><li class=mb-3><a class=text-color href=/notice/tetrate-istio-fundamental-courses/>Tetrate Academy Releases Free Istio Fundamentals Course</a></li></ul></div></div></div></div><div class="copyright py-4 bg-footer"><div class=container><div class=row><div class="col-sm-9 text-sm-left text-center"><p class="mb-0 text-color">© 2022 BIS All Rights Reserved</p></div><div class="col-sm-3 text-sm-right text-center"><ul class=list-inline><li class=list-inline-item><a class="d-inline-block p-2" href=https://twitter.com/jimmysongio target=_blank rel=noopener><i class="fa fa-twitter"></i></a></li><li class=list-inline-item><a class="d-inline-block p-2" href=https://github.com/sdmxio target=_blank rel=noopener><i class="fa fa-github"></i></a></li><li class=list-inline-item><a class="d-inline-block p-2" href=https://linkedin.com/in/sdmxio target=_blank rel=noopener><i class="fa fa-linkedin"></i></a></li><li class=list-inline-item><a class="d-inline-block p-2" href=mailto:info@sdmxio.io target=_blank rel=noopener><i class="fa fa-envelope"></i></a></li></ul></div></div></div></div></footer><script src=/plugins/jQuery/jquery.min.js></script>
<script src=/plugins/bootstrap/bootstrap.min.js></script>
<script src=/plugins/slick/slick.min.js></script>
<script src=/plugins/venobox/venobox.min.js></script>
<script src=/plugins/filterizr/jquery.filterizr.min.js></script>
<script src=/plugins/search/fuse.min.js></script>
<script src=/plugins/search/mark.js></script>
<script src=/plugins/search/search.js></script>
<script src=/plugins/hex_md5/hex_md5.js></script>
<script src=/plugins/anchor/anchor.min.js></script>
<script src=/plugins/tocbot/tocbot.min.js></script>
<script src=/plugins/bigger-picture/bigger-picture.min.js></script>
<script src=/js/script.min.js></script><meta name=baidu-site-verification content="g8IYR9SNLF"><script src=https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.js></script>
<script>docsearch({apiKey:"d7f7189aef2be4e5be6a6b9f44897f61",indexName:"DocSearch",appId:"CRNDR5CNMU",inputSelector:"#js-algolia-btn",debug:!1})</script><script>tocbot.init({tocSelector:"#TableOfContents",contentSelector:".content",headingSelector:"h1, h2, h3, h4",hasInnerContainers:!1,collapseDepth:3})</script></body></html>